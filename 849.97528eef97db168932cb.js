(self.webpackChunkviewer=self.webpackChunkviewer||[]).push([[849],{849:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>re});var r=n(77865),i=n.n(r),o=n(21704),a=n.n(o),s=n(22122),c=n(28481),l=n(6610),u=n(5991),d=n(10379),p=n(46070),f=n(77608),h=n(9957),m=n.n(h),v=n(46907),y=n(44029),g=n(41591),b=n(12470),w=n.n(b);var k=function(e){var t=function(t){(0,d.Z)(a,t);var n,r,o=(n=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,f.Z)(n);if(r){var i=(0,f.Z)(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return(0,p.Z)(this,e)});function a(){return(0,l.Z)(this,a),o.apply(this,arguments)}return(0,u.Z)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.camera,n=e.bcfViewpoint;this.setUpViewer(),t&&this.setCamera(),this.loadPlugins();var r=this.loadModels();n&&this.setBCFViewpoints(r),this.pickEntity()}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props;if(e.models!==n.models){var r=w()(n.models,e.models),i=w()(e.models,n.models);console.log("toRemove",i);var o=r.map((function(e){return t.modelLoader.load(e)}));n.bcfViewpoint&&this.setBCFViewpoints(o),i.forEach((function(e){var n=e.id;console.log("this.viewer.scene.models",t.viewer.scene.models);var r=t.viewer.scene.models[n];r&&r.destroy()}))}}},{key:"componentWillUnmount",value:function(){this.viewer.destroy()}},{key:"setUpViewer",value:function(){var e=this.props.canvasID;this.viewer=new v.A({canvasId:e})}},{key:"setCamera",value:function(){var e=this.viewer.scene.camera,t=this.props.camera,n=t.eye,r=t.look,i=t.up,o=t.zoom;e.eye=n,e.look=r,e.up=i,e.zoom(o)}},{key:"setBCFViewpoints",value:function(e){var t=this,n=this.props.bcfViewpoint,r=e.map((function(e){return new Promise((function(t){return e.on("loaded",t)}))}));Promise.all(r).then((function(){return t.BCFViewpointsPlugin.setViewpoint(n)}))}},{key:"loadModels",value:function(){var e=this,t=this.props.models;return console.log("models",t),t.map((function(t){return e.modelLoader.load(t)}))}},{key:"loadPlugins",value:function(){var t=this.props,n=t.bcfViewpoint,r=t.navCubeSettings;this.modelLoader=new e(this.viewer),n&&(this.BCFViewpointsPlugin=new y.G(this.viewer)),r&&new g.y(this.viewer,r)}},{key:"pickEntity",value:function(){var e=this,t=this.props.eventToPickOn,n=null,r=null,i=this.viewer.scene;i.input.on(t,(function(t){var o=i.pick({canvasPos:t});o?(console.log(o.entity.id),n&&o.entity.id===n.id||(n&&(n.colorize=r),n=o.entity,r=o.entity.colorize.slice(),o.entity.colorize=[0,1,0]),e.props.onSelect&&e.props.onSelect(o.entity.id)):n&&(n.colorize=r,n=null)}))}},{key:"takeScreenshot",value:function(){var e=this.viewer.getSnapshot({format:"png"}),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","model-screenshot"),t.click()}},{key:"render",value:function(){var e=this,t=this.props,n=t.canvasID,r=t.width,o=t.height,a=t.navCubeSettings,s=t.enableScreenshot;return i().createElement("div",null,i().createElement("canvas",{id:n,width:r,height:o,style:{zIndex:-1},className:"d-block mx-auto border border-secondary m-3 mw-100"}),a?i().createElement("canvas",{id:a.canvasId,width:a.canvasWidth,height:a.canvasHeight,style:{position:"fixed",right:0,bottom:0},className:"d-block mx-auto mw-100"}):null,s?i().createElement("button",{type:"button",id:"take-screenshot",className:"btn btn-primary",onClick:function(){return e.takeScreenshot()}},"Take Screenshot"):null)}}]),a}(r.Component);return t.propTypes={canvasID:m().string.isRequired,width:m().number,height:m().number,camera:m().object,models:m().arrayOf(m().shape({id:m().string.isRequired,src:m().string.isRequired})).isRequired,bcfViewpoint:m().object,eventToPickOn:m().string,navCubeSettings:m().shape({canvasId:m().string.isRequired,canvasWidth:m().number,canvasHeight:m().number}),enableScreenshot:m().bool},t.defaultProps={eventToPickOn:"mouseclicked"},t},E=n(64744),S=n(65958),C=(k(E.H),k(S.n),n(85061)),R=n(92137),j=n(87757),x=n.n(j),Z=(n(31956),n(55877));var I=function(e){(0,d.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,f.Z)(t);if(n){var i=(0,f.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,p.Z)(this,e)});function o(e){var t;return(0,l.Z)(this,o),(t=r.call(this,e)).state={},t}return(0,u.Z)(o,[{key:"componentDidMount",value:function(){var e,t=this,n=this.setViewer();"gltf"==="gltf".toLowerCase()&&(e=new E.H(n)),new g.y(n,{canvasId:"myNavCubeCanvas",visible:!0}),this.props.models.forEach((function(t){var r={id:(0,Z.v4)(),src:t,edges:!0,performance:!0},i=e.load(r);i.on("loaded",(function(){n.cameraFlight.jumpTo(i)}))})),n.scene.camera.projection=this.props.projection||"ortho";var r=null;n.scene.input.on("mousemove",(function(e){var i=n.scene.pick({canvasPos:e});i?r&&i.entity.id===r.id||(r&&(r.opacity=t.state.lastOpacity),r=i.entity,t.setState({lastOpacity:i.entity.opacity}),i.entity.opacity=.6):r&&(r.opacity=t.state.lastOpacity)})),n.cameraControl.on("picked",function(){var e=(0,R.Z)(x().mark((function e(n){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.entity)try{n.entity.highlighted=1,r=t.state.viewer.scene.objects,Object.keys(r).forEach((function(e){r[e].id!==n.entity.id&&(r[e].highlighted=!1)})),t.props.onSelect([n.entity.id])}catch(e){t.setState({selection:[]})}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.cameraControl.on("pickedNothing",(function(){var e=t.state.viewer.scene.objects;Object.keys(e).forEach((function(t){e[t].highlighted=!1})),t.setState({selection:[]}),t.props.onSelect([])})),this.setState({viewer:n})}},{key:"getGuid",value:function(e){var t=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],n=e[0].charCodeAt(0),r=n+e[1],i=n;i<r;++i)t.push(i);return String.fromCharCode.apply(null,t)})).join(""),n=function(e,n){return(n&&4!=n?[0,6]:[0,6,12,18]).map((function(n){return t.substr(parseInt(e/(1<<n))%64,1)})).reverse().join("")},r=e.split("-"),i="";return r.forEach((function(e,t){0<t&&t<r.length-2?i+=e+"-":t===r.length-2&&(i+=e)})),function(e){e=e.replace(/-/g,"");var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return n(t[0],2)+[1,4,7,10,13].map((function(e){return n((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")}(i)}},{key:"componentDidUpdate",value:function(){var e=this.state.viewer.scene.objects,t=this.props.selection;t&&t!==this.state.lastQueried&&(Object.keys(e).forEach((function(n){t.includes(e[n].id)?e[n].highlighted=!0:e[n].highlighted=!1})),this.setState({lastQueried:t,selection:t}))}},{key:"setViewer",value:function(){return new v.A({canvasId:"myCanvas",transparent:!0})}},{key:"render",value:function(){return i().createElement("div",{className:"modelContainer",style:{width:"100%",height:this.props.height}},i().createElement("canvas",{id:"myCanvas",style:{width:"100%",height:this.props.height}}),i().createElement("canvas",{style:{height:"200px",width:"200px",position:"fixed",right:0,bottom:0},className:"navCube",id:"myNavCubeCanvas"}),i().createElement("canvas",{id:"mySectionPlanesOverviewCanvas",className:"sections"}))}}]),o}(r.Component);function P(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}I.propTypes={projection:m().oneOf(["ortho","perspective"]),height:m().string.isRequired,width:m().string.isRequired,models:m().array.isRequired,metaModel:m().string,ifcGuidHandler:m().func},I.defaultProps={projection:"ortho",ifcGuidHandler:function(e){console.log(e)},onSelect:function(e){console.log("guid",e.guid)}},n(99718);var V=n(7265).newEngine,T=n(55877),q=n(81344).DataFactory;q.namedNode,q.literal,q.defaultGraph,q.quad;const A=function(e){var t=e.sharedProps,n=(t.session,t.activeResources),o=t.projects,a=t.selectedElements,s=t.setSelectedElements,l=t.selectionId,u=t.setSelectionId,d=t.store,p=(o[0],e.dimensions),f=p.width,h=p.height,m=(0,r.useState)([]),v=(0,c.Z)(m,2),y=v[0],g=v[1],b=(0,r.useState)([]),w=(0,c.Z)(b,2),k=w[0],E=w[1],S=(0,r.useState)(l),j=(0,c.Z)(S,2),Z=(j[0],j[1]);function O(e,t){return q.apply(this,arguments)}function q(){return(q=(0,R.Z)(x().mark((function e(t,n){var r,i,o,a,s,c,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=P(y),e.prev=1,r.s();case 3:if((i=r.n()).done){e.next=16;break}return o=i.value,a=V(),s="\n          PREFIX lbd: <https://lbdserver.org/vocabulary#>\n          PREFIX dcat: <http://www.w3.org/ns/dcat#>\n          SELECT DISTINCT ?elementId WHERE {\n            <".concat(t,"> lbd:hasLinkElement ?le . ?le lbd:hasDocument <").concat(o.main,"> ; lbd:hasIdentifier ?identifier . ?identifier lbd:identifier ?elementId . \n          }"),e.next=9,a.query(s,{sources:[o.artefactRegistry]});case 9:return c=e.sent,e.next=12,c.bindings();case 12:return l=e.sent,e.abrupt("return",l.map((function(e){return{local:e.get("?elementId").id.replaceAll('"',""),global:t}})));case 14:e.next=3;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[1,18,21,24]])})))).apply(this,arguments)}function A(e){return N.apply(this,arguments)}function N(){return(N=(0,R.Z)(x().mark((function e(t){var n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.filter((function(e){return!k.map((function(e){return e.global})).includes(e.global)})).map((function(e){return e.global.map((function(e){return O(e,d)}))})),e.next=3,Promise.all(n.flat());case 3:r=e.sent,E(r.flat());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=(0,R.Z)(x().mark((function e(t){var n,r,i,o,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=T(),Z(n),E([]),s([]),u(n),r=V(),i=P(t),e.prev=7,a=x().mark((function e(){var t,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.value,i='\n    PREFIX lbd: <https://lbdserver.org/vocabulary#>\n    SELECT ?art WHERE {\n      ?art lbd:hasLinkElement ?le .\n      ?le lbd:hasIdentifier ?id . \n      ?id lbd:identifier "'.concat(t,'" .\n    }'),e.next=4,r.query(i,{sources:[d]});case 4:e.sent.bindingsStream.on("data",function(){var e=(0,R.Z)(x().mark((function e(r){var i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r.get("?art").id,E((function(e){return[].concat((0,C.Z)(e),[{local:t,global:i}])})),s((function(e){return[].concat((0,C.Z)(e),[{global:[i],selectionId:n}])}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})),i.s();case 10:if((o=i.n()).done){e.next=14;break}return e.delegateYield(a(),"t0",12);case 12:e.next=10;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(7),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,16,19,22]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){a.length>0?A(a):A([])}),[a]),(0,r.useEffect)((function(){console.log("reset selection id"),E((function(e){return[]}))}),[l]),(0,r.useEffect)((function(){var e=n.filter((function(e){return e.main.endsWith(".gltf")}));g(e)}),[n]),i().createElement("div",{style:{textAlign:"center",width:f,height:h}},y.length>0?i().createElement(I,{height:"100%",width:"100%",models:y.map((function(e){return e.main})),projection:"perspective",onSelect:function(e){return F.apply(this,arguments)},selection:k.map((function(e){return e.local}))}):i().createElement("div",null,i().createElement("p",{style:{paddingTop:"10%"}},"No glTF models selected ")))};var N=n(5034),F=n(26975),D=n(38399),B=n(60306),z=(0,N.Z)({productionPrefix:B.name,seed:B.name});const H=function(e){var t=e.sharedProps,n=e.inactive,o=(t.session,t.activeResources),a=t.projects,l=(t.selectedElements,t.setSelectedElements,t.selectionId),u=(t.setSelectionId,a[0],e.module.dimensions),d=(u.width,u.height,(0,r.useState)([])),p=(0,c.Z)(d,2),f=(p[0],p[1]),h=(0,r.useState)([]),m=(0,c.Z)(h,2),v=(m[0],m[1],(0,r.useState)(l)),y=(0,c.Z)(v,2);return y[0],y[1],(0,r.useEffect)((function(){var e=o.filter((function(e){return e.main.endsWith(".gltf")}));f(e)}),[o]),n?i().createElement(i().Fragment,null):i().createElement(F.ZP,{generateClassName:z},i().createElement("div",null,i().createElement(A,(0,s.Z)({},e,{dimensions:{width:e.module.dimensions.w,height:e.module.dimensions.h}}))))};var L=n(24853),W=n(75073),M=n(81344),U=((0,L.atom)({key:"session",default:new W.Session}),(0,L.atom)({key:"store",default:new M.Store})),G=(0,L.atom)({key:"projects",default:["http://localhost:5000/jeroen/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/"]}),Q=(0,L.atom)({key:"activeResources",default:[{main:"http://localhost:5000/jeroen/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/architectural_duplex.gltf",meta:"http://localhost:5000/jeroen/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/architectural_duplex.gltf.props.ttl"}]}),X=(0,L.atom)({key:"selectedElements",default:[]}),_=(0,L.atom)({key:"selectionId",default:""}),$=(0,L.atom)({key:"trigger",default:"0"}),J=n(60698),Y=n(89875),K=n(16837),ee=n(60306),te=function(e,t,n){var r;if(n)r=i().createElement(n,null);else{var o={};t&&(o=t),r=i().createElement(H,o)}a().render(r,e)},ne=document.querySelector("#t4cbcae88");ne&&(console.log(ne),te(ne,{},(function(){var e={url:ee.domain,scope:ee.name,label:ee.name,module:"./index",dimensions:{x:0,y:0,h:850,w:600}},t=function(e,t){return function(){var n=(0,r.useState)(!0),o=(0,c.Z)(n,2),a=o[0],s=o[1],l=(0,L.useRecoilState)(Q),u=(0,c.Z)(l,2),d=u[0],p=u[1],f=(0,L.useRecoilState)(X),h=(0,c.Z)(f,2),m=h[0],v=h[1],y=(0,L.useRecoilState)(G),g=(0,c.Z)(y,2),b=g[0],w=g[1],k=(0,L.useRecoilState)(_),E=(0,c.Z)(k,2),S=E[0],C=E[1],R=(0,L.useRecoilState)($),j=(0,c.Z)(R,2),x=j[0],Z=j[1],I=(0,L.useRecoilValue)(U),P={projects:b,setProjects:w,activeResources:d,setActiveResources:p,selectedElements:m,setSelectedElements:v,selectionId:S,setSelectionId:C,trigger:x,setTrigger:Z,store:I};return i().createElement("div",null,i().createElement(D.IconButton,{style:{position:"absolute",right:a?450:0},variant:"contained",color:"primary",onClick:function(){return s(!a)}},a?i().createElement(i().Fragment,null):i().createElement(Y.default,null)),i().createElement(K.Options,{openOptions:a,setOpenOptions:s,trigger:x,setTrigger:Z,projects:b,setProjects:w,store:I,drawerWidth:"25%"})," ",i().createElement(e,{sharedProps:P,module:t,inactive:!1}))}}(H,e);return i().createElement("div",{style:{width:e.dimensions.w,height:e.dimensions.h}},i().createElement(L.RecoilRoot,null,i().createElement(J.QueryClientProvider,{client:new J.QueryClient},i().createElement(t,{module:e}))))})));const re=te},60306:e=>{"use strict";e.exports=JSON.parse('{"name":"viewer","version":"1.0.0","port":8082,"domain":"https://consolidproject.github.io/pluginViewer/","scripts":{"start":"webpack serve --config config/webpack.dev.js","build:dev":"webpack --config config/webpack.dev.js","build":"webpack --config config/webpack.prod.js"},"dependencies":{"@comunica/actor-init-sparql":"^1.22.2","@inrupt/solid-client-authn-browser":"^1.11.2","@material-ui/core":"^4.12.3","@material-ui/icons":"^4.9.1","@xeokit/xeokit-sdk":"^1.9.0","assert":"^2.0.0","browserify-zlib":"^0.2.0","buffer":"^6.0.3","consolid":"^1.0.2","consolid-react-ui":"0.0.11","core-js":"^3.18.1","crypto-browserify":"^3.12.0","events":"^3.3.0","graphql-ld-comunica-solid":"^1.0.1","lodash.difference":"^4.5.0","mem":"^9.0.1","n3":"^1.10.0","os-browserify":"^0.3.0","path-browserify":"^1.0.1","process":"^0.11.10","prop-types":"^15.7.2","react":"^17.0.1","react-dom":"^17.0.1","react-query":"^3.24.4","react-router-dom":"^5.2.0","recoil":"^0.4.1","source-map-loader":"^3.0.0","stream-browserify":"^3.0.0"},"devDependencies":{"@babel/core":"^7.12.3","@babel/plugin-transform-runtime":"^7.12.1","@babel/preset-env":"^7.12.1","@babel/preset-react":"^7.12.1","babel-loader":"^8.1.0","clean-webpack-plugin":"^3.0.0","css-loader":"^5.0.0","html-webpack-plugin":"^4.5.0","style-loader":"^2.0.0","webpack":"^5.4.0","webpack-cli":"^4.7.0","webpack-dev-server":"^3.11.0","webpack-merge":"^5.2.0"}}')}}]);