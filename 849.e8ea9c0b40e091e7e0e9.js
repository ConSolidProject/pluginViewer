(self.webpackChunkviewer=self.webpackChunkviewer||[]).push([[849],{849:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>te});var r=n(77865),i=n.n(r),o=n(21704),s=n.n(o),a=n(22122),c=n(92137),l=n(28481),u=n(87757),d=n.n(u),p=n(6610),f=n(5991),h=n(10379),m=n(46070),v=n(77608),y=n(9957),g=n.n(y),b=n(46907),w=n(44029),k=n(41591),S=n(12470),E=n.n(S);var j=function(e){var t=function(t){(0,h.Z)(s,t);var n,r,o=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,v.Z)(n);if(r){var i=(0,v.Z)(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return(0,m.Z)(this,e)});function s(){return(0,p.Z)(this,s),o.apply(this,arguments)}return(0,f.Z)(s,[{key:"componentDidMount",value:function(){var e=this.props,t=e.camera,n=e.bcfViewpoint;this.setUpViewer(),t&&this.setCamera(),this.loadPlugins();var r=this.loadModels();n&&this.setBCFViewpoints(r),this.pickEntity()}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props;if(e.models!==n.models){var r=E()(n.models,e.models),i=E()(e.models,n.models);console.log("toRemove",i);var o=r.map((function(e){return t.modelLoader.load(e)}));n.bcfViewpoint&&this.setBCFViewpoints(o),i.forEach((function(e){var n=e.id;console.log("this.viewer.scene.models",t.viewer.scene.models);var r=t.viewer.scene.models[n];r&&r.destroy()}))}}},{key:"componentWillUnmount",value:function(){this.viewer.destroy()}},{key:"setUpViewer",value:function(){var e=this.props.canvasID;this.viewer=new b.A({canvasId:e})}},{key:"setCamera",value:function(){var e=this.viewer.scene.camera,t=this.props.camera,n=t.eye,r=t.look,i=t.up,o=t.zoom;e.eye=n,e.look=r,e.up=i,e.zoom(o)}},{key:"setBCFViewpoints",value:function(e){var t=this,n=this.props.bcfViewpoint,r=e.map((function(e){return new Promise((function(t){return e.on("loaded",t)}))}));Promise.all(r).then((function(){return t.BCFViewpointsPlugin.setViewpoint(n)}))}},{key:"loadModels",value:function(){var e=this,t=this.props.models;return console.log("models",t),t.map((function(t){return e.modelLoader.load(t)}))}},{key:"loadPlugins",value:function(){var t=this.props,n=t.bcfViewpoint,r=t.navCubeSettings;this.modelLoader=new e(this.viewer),n&&(this.BCFViewpointsPlugin=new w.G(this.viewer)),r&&new k.y(this.viewer,r)}},{key:"pickEntity",value:function(){var e=this,t=this.props.eventToPickOn,n=null,r=null,i=this.viewer.scene;i.input.on(t,(function(t){var o=i.pick({canvasPos:t});o?(console.log(o.entity.id),n&&o.entity.id===n.id||(n&&(n.colorize=r),n=o.entity,r=o.entity.colorize.slice(),o.entity.colorize=[0,1,0]),e.props.onSelect&&e.props.onSelect(o.entity.id)):n&&(n.colorize=r,n=null)}))}},{key:"takeScreenshot",value:function(){var e=this.viewer.getSnapshot({format:"png"}),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","model-screenshot"),t.click()}},{key:"render",value:function(){var e=this,t=this.props,n=t.canvasID,r=t.width,o=t.height,s=t.navCubeSettings,a=t.enableScreenshot;return i().createElement("div",null,i().createElement("canvas",{id:n,width:r,height:o,style:{zIndex:-1},className:"d-block mx-auto border border-secondary m-3 mw-100"}),s?i().createElement("canvas",{id:s.canvasId,width:s.canvasWidth,height:s.canvasHeight,style:{position:"fixed",right:0,bottom:0},className:"d-block mx-auto mw-100"}):null,a?i().createElement("button",{type:"button",id:"take-screenshot",className:"btn btn-primary",onClick:function(){return e.takeScreenshot()}},"Take Screenshot"):null)}}]),s}(r.Component);return t.propTypes={canvasID:g().string.isRequired,width:g().number,height:g().number,camera:g().object,models:g().arrayOf(g().shape({id:g().string.isRequired,src:g().string.isRequired})).isRequired,bcfViewpoint:g().object,eventToPickOn:g().string,navCubeSettings:g().shape({canvasId:g().string.isRequired,canvasWidth:g().number,canvasHeight:g().number}),enableScreenshot:g().bool},t.defaultProps={eventToPickOn:"mouseclicked"},t},C=n(64744),x=n(65958),Z=(j(C.H),j(x.n),n(90484),n(31956),n(55877));var R=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,v.Z)(t);if(n){var i=(0,v.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,m.Z)(this,e)});function o(e){var t;return(0,p.Z)(this,o),(t=r.call(this,e)).state={},t}return(0,f.Z)(o,[{key:"componentDidMount",value:function(){var e,t=this,n=this.setViewer();e=new C.H(n),new k.y(n,{canvasId:"myNavCubeCanvas",visible:!0}),this.props.models.forEach((function(t){var r={id:(0,Z.v4)(),src:t,edges:!0,performance:!0},i=e.load(r);i.on("loaded",(function(){n.cameraFlight.jumpTo(i)}))})),n.scene.camera.projection=this.props.projection||"ortho";var r=null;n.scene.input.on("mousemove",(function(e){var i=n.scene.pick({canvasPos:e});i?r&&i.entity.id===r.id||(r&&(r.opacity=t.state.lastOpacity),r=i.entity,t.setState({lastOpacity:i.entity.opacity}),i.entity.opacity=.6):r&&(r.opacity=t.state.lastOpacity)})),n.cameraControl.on("picked",function(){var e=(0,c.Z)(d().mark((function e(n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.entity)try{n.entity.highlighted=1,r=t.state.viewer.scene.objects,Object.keys(r).forEach((function(e){r[e].id!==n.entity.id&&(r[e].highlighted=!1)})),t.props.onSelect([n.entity.id])}catch(e){t.setState({selection:[]})}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.cameraControl.on("pickedNothing",(function(){var e=t.state.viewer.scene.objects;Object.keys(e).forEach((function(t){e[t].highlighted=!1})),t.setState({selection:[]}),t.props.onSelect([])})),this.setState({viewer:n})}},{key:"getGuid",value:function(e){var t=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],n=e[0].charCodeAt(0),r=n+e[1],i=n;i<r;++i)t.push(i);return String.fromCharCode.apply(null,t)})).join(""),n=function(e,n){return(n&&4!=n?[0,6]:[0,6,12,18]).map((function(n){return t.substr(parseInt(e/(1<<n))%64,1)})).reverse().join("")},r=e.split("-"),i="";return r.forEach((function(e,t){0<t&&t<r.length-2?i+=e+"-":t===r.length-2&&(i+=e)})),function(e){e=e.replace(/-/g,"");var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return n(t[0],2)+[1,4,7,10,13].map((function(e){return n((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")}(i)}},{key:"componentDidUpdate",value:function(){var e=this.state.viewer.scene.objects,t=this.props.selection;t&&t!==this.state.lastQueried&&(Object.keys(e).forEach((function(n){t.includes(e[n].id)?e[n].highlighted=!0:e[n].highlighted=!1})),this.setState({lastQueried:t,selection:t}))}},{key:"setViewer",value:function(){return new b.A({canvasId:"myCanvas",transparent:!0})}},{key:"render",value:function(){return i().createElement("div",{className:"modelContainer",style:{width:"100%",height:this.props.height}},i().createElement("canvas",{id:"myCanvas",style:{width:"100%",height:this.props.height}}),i().createElement("canvas",{style:{height:"200px",width:"200px",position:"fixed",right:0,bottom:0},className:"navCube",id:"myNavCubeCanvas"}),i().createElement("canvas",{id:"mySectionPlanesOverviewCanvas",className:"sections"}))}}]),o}(r.Component);R.propTypes={projection:g().oneOf(["ortho","perspective"]),height:g().string.isRequired,width:g().string.isRequired,models:g().array.isRequired,metaModel:g().string,ifcGuidHandler:g().func},R.defaultProps={projection:"ortho",ifcGuidHandler:function(e){console.log(e)},onSelect:function(e){console.log("guid",e.guid)}};var P=n(1487);function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n(7265).newEngine,n(55877);var V=n(81344).DataFactory;V.namedNode,V.literal,V.defaultGraph,V.quad;const T=function(e){var t=e.models,n=e.sharedProps,o=n.session,s=(n.datasets,n.projects),a=n.selectedElements,u=(n.setSelectedElements,n.selectionId),p=(n.setSelectionId,n.store,s[Object.keys(s)[0]]),f=e.dimensions,h=f.width,m=f.height,v=(0,r.useState)([]),y=(0,l.Z)(v,2),g=(y[0],y[1],(0,r.useState)([])),b=(0,l.Z)(g,2),w=b[0],k=b[1],S=(0,r.useState)(u),E=(0,l.Z)(S,2),j=(E[0],E[1],(0,r.useState)(null)),C=(0,l.Z)(j,2);function x(){return(x=(0,c.Z)(d().mark((function e(n){var r,i,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=O(t);try{for(s=function(){var e=o.value,t=n.map((function(e){return e.references})).flat().filter((function(t){return t.dataset==e.dataset})).map((function(e){return e.id}));r.push(t)},i.s();!(o=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}r.length>0&&k(r.flat());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(){return(Z=(0,c.Z)(d().mark((function e(n){var r,i,s,a,c,l,u,f,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("items 123",n),e.next=3,(0,P.findReferenceEndpoints)(p,o);case 3:r=e.sent,i=O(t),e.prev=5,i.s();case 7:if((s=i.n()).done){e.next=32;break}a=s.value,c=O(r),e.prev=10,c.s();case 12:if((l=c.n()).done){e.next=22;break}return u=l.value,console.log("ref",u),f={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({selection:[{dataset:a.dataset,identifiers:n}]})},e.next=18,o.fetch(u,f).then((function(e){return e.json()}));case 18:h=e.sent,console.log("viewerSelection",h);case 20:e.next=12;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(10),c.e(e.t0);case 27:return e.prev=27,c.f(),e.finish(27);case 30:e.next=7;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(5),i.e(e.t1);case 37:return e.prev=37,i.f(),e.finish(37);case 40:case"end":return e.stop()}}),e,null,[[5,34,37,40],[10,24,27,30]])})))).apply(this,arguments)}return C[0],C[1],(0,r.useEffect)((function(){a.length>0&&function(e){x.apply(this,arguments)}(a)}),[a]),(0,r.useEffect)((function(){console.log("reset selection id"),k((function(e){return[]}))}),[u]),i().createElement("div",{style:{textAlign:"center",width:h,height:m}},t.length>0?i().createElement(R,{height:"100%",width:"100%",models:t.map((function(e){return e.url})),projection:"perspective",onSelect:function(e){return Z.apply(this,arguments)},selection:w}):i().createElement("div",null,i().createElement("p",{style:{paddingTop:"10%"}},"No glTF models selected ")))};var N=n(5034),q=n(26975),A=n(38399),B=n(60306),D=(0,N.Z)({productionPrefix:B.name,seed:B.name});const F=function(e){var t=e.sharedProps,n=e.inactive,o=t.session,s=t.datasets,u=t.projects,p=(t.selectedElements,t.setSelectedElements,t.selectionId),f=(t.setSelectionId,u[0],e.module.dimensions),h=(f.width,f.height,(0,r.useState)([])),m=(0,l.Z)(h,2),v=m[0],y=m[1],g=(0,r.useState)([]),b=(0,l.Z)(g,2),w=(b[0],b[1],(0,r.useState)(p)),k=(0,l.Z)(w,2);return k[0],k[1],(0,r.useEffect)((function(){function e(){return(e=(0,c.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,P.getDistributionsByMediaType)(s,"model/gltf+json",o);case 2:t=e.sent,y(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[s]),n?i().createElement(i().Fragment,null):i().createElement(q.ZP,{generateClassName:D},i().createElement("div",null,i().createElement(T,(0,a.Z)({},e,{models:v,dimensions:{width:e.module.dimensions.w,height:e.module.dimensions.h}}))))};var z=n(24853),M=n(75073),H=n(81344),U=((0,z.atom)({key:"session",default:new M.Session}),(0,z.atom)({key:"store",default:new H.Store})),G=(0,z.atom)({key:"projects",default:["https://pod.lbdserver.org/jeroen/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/"]}),Q=(0,z.atom)({key:"datasets",default:[{main:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/architectural_duplex.gltf",meta:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/architectural_duplex.gltf.props.ttl",artefactRegistry:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/artefactRegistry.ttl"}]}),W=(0,z.atom)({key:"selectedElements",default:[]}),L=(0,z.atom)({key:"selectionId",default:""}),_=(0,z.atom)({key:"trigger",default:"0"}),J=n(60698),$=n(89875),K=n(16837),X=n(60306),Y=function(e,t,n){var r;if(n)r=i().createElement(n,null);else{var o={};t&&(o=t),r=i().createElement(F,o)}s().render(r,e)},ee=document.querySelector("#t4cbcae88");ee&&(console.log(ee),Y(ee,{},(function(){var e={url:X.domain,scope:X.name,label:X.name,module:"./index",dimensions:{x:0,y:0,h:850,w:600}},t=function(e,t){return function(){var n=(0,r.useState)(!0),o=(0,l.Z)(n,2),s=o[0],a=o[1],c=(0,z.useRecoilState)(Q),u=(0,l.Z)(c,2),d=u[0],p=u[1],f=(0,z.useRecoilState)(W),h=(0,l.Z)(f,2),m=h[0],v=h[1],y=(0,z.useRecoilState)(G),g=(0,l.Z)(y,2),b=g[0],w=g[1],k=(0,z.useRecoilState)(L),S=(0,l.Z)(k,2),E=S[0],j=S[1],C=(0,z.useRecoilState)(_),x=(0,l.Z)(C,2),Z=x[0],R=x[1],P=(0,z.useRecoilValue)(U),O={projects:b,setProjects:w,datasets:d,setDatasets:p,selectedElements:m,setSelectedElements:v,selectionId:E,setSelectionId:j,trigger:Z,setTrigger:R,store:P};return i().createElement("div",null,i().createElement(A.IconButton,{style:{position:"absolute",right:s?450:0},variant:"contained",color:"primary",onClick:function(){return a(!s)}},s?i().createElement(i().Fragment,null):i().createElement($.default,null)),i().createElement(K.Options,{openOptions:s,setOpenOptions:a,trigger:Z,setTrigger:R,projects:b,setProjects:w,store:P,drawerWidth:"25%"})," ",i().createElement(e,{sharedProps:O,module:t,inactive:!1}))}}(F,e);return i().createElement("div",{style:{width:e.dimensions.w,height:e.dimensions.h}},i().createElement(z.RecoilRoot,null,i().createElement(J.QueryClientProvider,{client:new J.QueryClient},i().createElement(t,{module:e}))))})));const te=Y},60306:e=>{"use strict";e.exports=JSON.parse('{"name":"viewer","version":"1.0.0","port":8082,"domain":"https://consolidproject.github.io/pluginViewer/","scripts":{"start":"webpack serve --config config/webpack.dev.js","build:dev":"webpack --config config/webpack.dev.js","build":"webpack --config config/webpack.prod.js"},"dependencies":{"@comunica/actor-init-sparql":"^1.22.2","@inrupt/solid-client-authn-browser":"^1.11.2","@material-ui/core":"^4.12.3","@material-ui/icons":"^4.9.1","@xeokit/xeokit-sdk":"^1.9.0","assert":"^2.0.0","browserify-zlib":"^0.2.0","buffer":"^6.0.3","consolid-react-ui":"0.0.11","core-js":"^3.18.1","crypto-browserify":"^3.12.0","events":"^3.3.0","graphql-ld-comunica-solid":"^1.0.1","lodash.difference":"^4.5.0","mem":"^9.0.1","n3":"^1.10.0","os-browserify":"^0.3.0","path-browserify":"^1.0.1","process":"^0.11.10","prop-types":"^15.7.2","react":"^17.0.1","react-dom":"^17.0.1","react-query":"^3.24.4","react-router-dom":"^5.2.0","recoil":"^0.4.1","source-map-loader":"^3.0.0","stream-browserify":"^3.0.0"},"devDependencies":{"@babel/core":"^7.12.3","@babel/plugin-transform-runtime":"^7.12.1","@babel/preset-env":"^7.12.1","@babel/preset-react":"^7.12.1","babel-loader":"^8.1.0","clean-webpack-plugin":"^3.0.0","css-loader":"^5.0.0","html-webpack-plugin":"^4.5.0","style-loader":"^2.0.0","webpack":"^5.4.0","webpack-cli":"^4.7.0","webpack-dev-server":"^3.11.0","webpack-merge":"^5.2.0"}}')}}]);