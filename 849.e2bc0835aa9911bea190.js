(self.webpackChunkviewer=self.webpackChunkviewer||[]).push([[849],{849:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ie});var r=n(77865),i=n.n(r),o=n(21704),a=n.n(o),s=n(22122),c=n(28481),l=n(6610),u=n(5991),d=n(10379),p=n(46070),f=n(77608),h=n(9957),m=n.n(h),v=n(46907),g=n(44029),b=n(41591),y=n(12470),w=n.n(y);var k=function(e){var t=function(t){(0,d.Z)(a,t);var n,r,o=(n=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,f.Z)(n);if(r){var i=(0,f.Z)(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return(0,p.Z)(this,e)});function a(){return(0,l.Z)(this,a),o.apply(this,arguments)}return(0,u.Z)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.camera,n=e.bcfViewpoint;this.setUpViewer(),t&&this.setCamera(),this.loadPlugins();var r=this.loadModels();n&&this.setBCFViewpoints(r),this.pickEntity()}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props;if(e.models!==n.models){var r=w()(n.models,e.models),i=w()(e.models,n.models);console.log("toRemove",i);var o=r.map((function(e){return t.modelLoader.load(e)}));n.bcfViewpoint&&this.setBCFViewpoints(o),i.forEach((function(e){var n=e.id;console.log("this.viewer.scene.models",t.viewer.scene.models);var r=t.viewer.scene.models[n];r&&r.destroy()}))}}},{key:"componentWillUnmount",value:function(){this.viewer.destroy()}},{key:"setUpViewer",value:function(){var e=this.props.canvasID;this.viewer=new v.A({canvasId:e})}},{key:"setCamera",value:function(){var e=this.viewer.scene.camera,t=this.props.camera,n=t.eye,r=t.look,i=t.up,o=t.zoom;e.eye=n,e.look=r,e.up=i,e.zoom(o)}},{key:"setBCFViewpoints",value:function(e){var t=this,n=this.props.bcfViewpoint,r=e.map((function(e){return new Promise((function(t){return e.on("loaded",t)}))}));Promise.all(r).then((function(){return t.BCFViewpointsPlugin.setViewpoint(n)}))}},{key:"loadModels",value:function(){var e=this,t=this.props.models;return console.log("models",t),t.map((function(t){return e.modelLoader.load(t)}))}},{key:"loadPlugins",value:function(){var t=this.props,n=t.bcfViewpoint,r=t.navCubeSettings;this.modelLoader=new e(this.viewer),n&&(this.BCFViewpointsPlugin=new g.G(this.viewer)),r&&new b.y(this.viewer,r)}},{key:"pickEntity",value:function(){var e=this,t=this.props.eventToPickOn,n=null,r=null,i=this.viewer.scene;i.input.on(t,(function(t){var o=i.pick({canvasPos:t});o?(console.log(o.entity.id),n&&o.entity.id===n.id||(n&&(n.colorize=r),n=o.entity,r=o.entity.colorize.slice(),o.entity.colorize=[0,1,0]),e.props.onSelect&&e.props.onSelect(o.entity.id)):n&&(n.colorize=r,n=null)}))}},{key:"takeScreenshot",value:function(){var e=this.viewer.getSnapshot({format:"png"}),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","model-screenshot"),t.click()}},{key:"render",value:function(){var e=this,t=this.props,n=t.canvasID,r=t.width,o=t.height,a=t.navCubeSettings,s=t.enableScreenshot;return i().createElement("div",null,i().createElement("canvas",{id:n,width:r,height:o,style:{zIndex:-1},className:"d-block mx-auto border border-secondary m-3 mw-100"}),a?i().createElement("canvas",{id:a.canvasId,width:a.canvasWidth,height:a.canvasHeight,style:{position:"fixed",right:0,bottom:0},className:"d-block mx-auto mw-100"}):null,s?i().createElement("button",{type:"button",id:"take-screenshot",className:"btn btn-primary",onClick:function(){return e.takeScreenshot()}},"Take Screenshot"):null)}}]),a}(r.Component);return t.propTypes={canvasID:m().string.isRequired,width:m().number,height:m().number,camera:m().object,models:m().arrayOf(m().shape({id:m().string.isRequired,src:m().string.isRequired})).isRequired,bcfViewpoint:m().object,eventToPickOn:m().string,navCubeSettings:m().shape({canvasId:m().string.isRequired,canvasWidth:m().number,canvasHeight:m().number}),enableScreenshot:m().bool},t.defaultProps={eventToPickOn:"mouseclicked"},t},E=n(64744),S=n(65958),R=(k(E.H),k(S.n),n(85061)),x=n(92137),C=n(87757),I=n.n(C),Z=(n(31956),n(55877));var j=function(e){(0,d.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,f.Z)(t);if(n){var i=(0,f.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,p.Z)(this,e)});function o(e){var t;return(0,l.Z)(this,o),(t=r.call(this,e)).state={},t}return(0,u.Z)(o,[{key:"componentDidMount",value:function(){var e,t=this,n=this.setViewer();"gltf"==="gltf".toLowerCase()&&(e=new E.H(n)),new b.y(n,{canvasId:"myNavCubeCanvas",visible:!0}),this.props.models.forEach((function(t){var r={id:(0,Z.v4)(),src:t,edges:!0,performance:!0},i=e.load(r);i.on("loaded",(function(){n.cameraFlight.jumpTo(i)}))})),n.scene.camera.projection=this.props.projection||"ortho";var r=null;n.scene.input.on("mousemove",(function(e){var i=n.scene.pick({canvasPos:e});i?r&&i.entity.id===r.id||(r&&(r.opacity=t.state.lastOpacity),r=i.entity,t.setState({lastOpacity:i.entity.opacity}),i.entity.opacity=.6):r&&(r.opacity=t.state.lastOpacity)})),n.cameraControl.on("picked",function(){var e=(0,x.Z)(I().mark((function e(n){var r;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.entity)try{n.entity.highlighted=1,r=t.state.viewer.scene.objects,Object.keys(r).forEach((function(e){r[e].id!==n.entity.id&&(r[e].highlighted=!1)})),t.props.onSelect([n.entity.id])}catch(e){t.setState({selection:[]})}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.cameraControl.on("pickedNothing",(function(){var e=t.state.viewer.scene.objects;Object.keys(e).forEach((function(t){e[t].highlighted=!1})),t.setState({selection:[]}),t.props.onSelect([])})),this.setState({viewer:n})}},{key:"getGuid",value:function(e){var t=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],n=e[0].charCodeAt(0),r=n+e[1],i=n;i<r;++i)t.push(i);return String.fromCharCode.apply(null,t)})).join(""),n=function(e,n){return(n&&4!=n?[0,6]:[0,6,12,18]).map((function(n){return t.substr(parseInt(e/(1<<n))%64,1)})).reverse().join("")},r=e.split("-"),i="";return r.forEach((function(e,t){0<t&&t<r.length-2?i+=e+"-":t===r.length-2&&(i+=e)})),function(e){e=e.replace(/-/g,"");var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return n(t[0],2)+[1,4,7,10,13].map((function(e){return n((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")}(i)}},{key:"componentDidUpdate",value:function(){var e=this.state.viewer.scene.objects,t=this.props.selection;t&&t!==this.state.lastQueried&&(Object.keys(e).forEach((function(n){t.includes(e[n].id)?e[n].highlighted=!0:e[n].highlighted=!1})),this.setState({lastQueried:t,selection:t}))}},{key:"setViewer",value:function(){return new v.A({canvasId:"myCanvas",transparent:!0})}},{key:"render",value:function(){return i().createElement("div",{className:"modelContainer",style:{width:"100%",height:this.props.height}},i().createElement("canvas",{id:"myCanvas",style:{width:"100%",height:this.props.height}}),i().createElement("canvas",{style:{height:"200px",width:"200px",position:"fixed",right:0,bottom:0},className:"navCube",id:"myNavCubeCanvas"}),i().createElement("canvas",{id:"mySectionPlanesOverviewCanvas",className:"sections"}))}}]),o}(r.Component);j.propTypes={projection:m().oneOf(["ortho","perspective"]),height:m().string.isRequired,width:m().string.isRequired,models:m().array.isRequired,metaModel:m().string,ifcGuidHandler:m().func},j.defaultProps={projection:"ortho",ifcGuidHandler:function(e){console.log(e)},onSelect:function(e){console.log("guid",e.guid)}};var P=n(23198);function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var T=n(7265).newEngine,V=n(55877),q=n(81344).DataFactory;q.namedNode,q.literal,q.defaultGraph,q.quad;const F=function(e){var t=e.sharedProps,n=t.session,o=t.activeResources,a=t.projects,s=t.selectedElements,l=t.setSelectedElements,u=t.selectionId,d=t.setSelectionId,p=t.store,f=a[0],h=e.dimensions,m=h.width,v=h.height,g=(0,r.useState)([]),b=(0,c.Z)(g,2),y=b[0],w=b[1],k=(0,r.useState)([]),E=(0,c.Z)(k,2),S=E[0],C=E[1],Z=(0,r.useState)(u),A=(0,c.Z)(Z,2),q=(A[0],A[1]),F=(0,r.useState)(null),N=(0,c.Z)(F,2),D=(N[0],N[1]);function B(e,t){return L.apply(this,arguments)}function L(){return(L=(0,x.Z)(I().mark((function e(t,n){var r,i,o,a,s,c,l;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=O(y),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=17;break}return o=i.value,a=T(),s="\n            PREFIX lbd: <https://lbdserver.org/vocabulary#>\n            PREFIX dcat: <http://www.w3.org/ns/dcat#>\n            SELECT DISTINCT ?elementId WHERE {\n              <".concat(t,"> lbd:hasLinkElement ?le . ?le lbd:hasDocument <").concat(o.main,"> ; lbd:hasIdentifier ?identifier . ?identifier lbd:identifier ?elementId . \n            }"),e.next=10,a.query(s,{sources:[n]});case 10:return c=e.sent,e.next=13,c.bindings(c);case 13:return l=e.sent,e.abrupt("return",l.map((function(e){return{local:e.get("?elementId").id.replaceAll('"',""),global:t}})));case 15:e.next=4;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(0),console.log("error in viewer",e.t1);case 30:case"end":return e.stop()}}),e,null,[[0,27],[2,19,22,25]])})))).apply(this,arguments)}function H(){return(H=(0,x.Z)(I().mark((function e(t){var n,r;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.filter((function(e){return!S.map((function(e){return e.global})).includes(e.global)})).map((function(e){return e.global.map((function(e){return B(e,p)}))})),e.next=3,Promise.all(n.flat());case 3:(r=e.sent).length>0&&C(r.flat());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=(0,x.Z)(I().mark((function e(t){var r,i,o,a,s,c;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.info.isLoggedIn){e.next=5;break}return e.next=3,(0,P.getMyArtefactRegistry)(n,f);case 3:r=e.sent,console.log("myArtReg",r);case 5:i=V(),q(i),C([]),l([]),d(i),D(i),o=T(),a=O(t),e.prev=13,c=I().mark((function e(){var t,n;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value,n='\n    PREFIX lbd: <https://lbdserver.org/vocabulary#>\n    SELECT ?art WHERE {\n      ?art lbd:hasLinkElement ?le .\n      ?le lbd:hasIdentifier ?id . \n      ?id lbd:identifier "'.concat(t,'" .\n    }'),e.next=4,o.query(n,{sources:[p]});case 4:e.sent.bindingsStream.on("data",function(){var e=(0,x.Z)(I().mark((function e(n){var r,a,s,c,u;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.get("?art").id,console.log("art",r),C((function(e){return[].concat((0,R.Z)(e),[{local:t,global:r}])})),a="\n      PREFIX owl: <http://www.w3.org/2002/07/owl#>\n      SELECT ?alias WHERE {\n        ?alias owl:sameAs <".concat(r,">.\n      }"),e.next=6,o.query(a,{sources:[p]});case 6:return s=e.sent,e.next=9,s.bindings();case 9:c=e.sent,u=c.map((function(e){return{global:[e.get("?alias").id],selectionId:i}})),console.log("aliases",u),l((function(e){return[].concat((0,R.Z)(e),(0,R.Z)(u),[{global:[r],selectionId:i}])}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})),a.s();case 16:if((s=a.n()).done){e.next=20;break}return e.delegateYield(c(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),a.e(e.t1);case 25:return e.prev=25,a.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[13,22,25,28]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){s.length>0&&function(e){H.apply(this,arguments)}(s)}),[s]),(0,r.useEffect)((function(){console.log("reset selection id"),C((function(e){return[]}))}),[u]),(0,r.useEffect)((function(){var e=o.filter((function(e){return e.main.endsWith(".gltf")}));w(e)}),[o]),i().createElement("div",{style:{textAlign:"center",width:m,height:v}},y.length>0?i().createElement(j,{height:"100%",width:"100%",models:y.map((function(e){return e.main})),projection:"perspective",onSelect:function(e){return W.apply(this,arguments)},selection:S.map((function(e){return e.local}))}):i().createElement("div",null,i().createElement("p",{style:{paddingTop:"10%"}},"No glTF models selected ")))};var N=n(5034),D=n(26975),B=n(38399),L=n(60306),H=(0,N.Z)({productionPrefix:L.name,seed:L.name});const W=function(e){var t=e.sharedProps,n=e.inactive,o=(t.session,t.activeResources),a=t.projects,l=(t.selectedElements,t.setSelectedElements,t.selectionId),u=(t.setSelectionId,a[0],e.module.dimensions),d=(u.width,u.height,(0,r.useState)([])),p=(0,c.Z)(d,2),f=(p[0],p[1]),h=(0,r.useState)([]),m=(0,c.Z)(h,2),v=(m[0],m[1],(0,r.useState)(l)),g=(0,c.Z)(v,2);return g[0],g[1],(0,r.useEffect)((function(){var e=o.filter((function(e){return e.main.endsWith(".gltf")}));f(e)}),[o]),n?i().createElement(i().Fragment,null):i().createElement(D.ZP,{generateClassName:H},i().createElement("div",null,i().createElement(F,(0,s.Z)({},e,{dimensions:{width:e.module.dimensions.w,height:e.module.dimensions.h}}))))};var z=n(24853),M=n(75073),U=n(81344),G=((0,z.atom)({key:"session",default:new M.Session}),(0,z.atom)({key:"store",default:new U.Store})),Q=(0,z.atom)({key:"projects",default:["https://pod.lbdserver.org/jeroen/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/"]}),X=(0,z.atom)({key:"activeResources",default:[{main:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/architectural_duplex.gltf",meta:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/architectural_duplex.gltf.props.ttl",artefactRegistry:"https://pod.lbdserver.org/pieter/lbd/f65db6eb-fc13-4ee7-955a-cf93fdf29d5b/artefactRegistry.ttl"}]}),_=(0,z.atom)({key:"selectedElements",default:[]}),$=(0,z.atom)({key:"selectionId",default:""}),J=(0,z.atom)({key:"trigger",default:"0"}),Y=n(60698),K=n(89875),ee=n(16837),te=n(60306),ne=function(e,t,n){var r;if(n)r=i().createElement(n,null);else{var o={};t&&(o=t),r=i().createElement(W,o)}a().render(r,e)},re=document.querySelector("#t4cbcae88");re&&(console.log(re),ne(re,{},(function(){var e={url:te.domain,scope:te.name,label:te.name,module:"./index",dimensions:{x:0,y:0,h:850,w:600}},t=function(e,t){return function(){var n=(0,r.useState)(!0),o=(0,c.Z)(n,2),a=o[0],s=o[1],l=(0,z.useRecoilState)(X),u=(0,c.Z)(l,2),d=u[0],p=u[1],f=(0,z.useRecoilState)(_),h=(0,c.Z)(f,2),m=h[0],v=h[1],g=(0,z.useRecoilState)(Q),b=(0,c.Z)(g,2),y=b[0],w=b[1],k=(0,z.useRecoilState)($),E=(0,c.Z)(k,2),S=E[0],R=E[1],x=(0,z.useRecoilState)(J),C=(0,c.Z)(x,2),I=C[0],Z=C[1],j=(0,z.useRecoilValue)(G),P={projects:y,setProjects:w,activeResources:d,setActiveResources:p,selectedElements:m,setSelectedElements:v,selectionId:S,setSelectionId:R,trigger:I,setTrigger:Z,store:j};return i().createElement("div",null,i().createElement(B.IconButton,{style:{position:"absolute",right:a?450:0},variant:"contained",color:"primary",onClick:function(){return s(!a)}},a?i().createElement(i().Fragment,null):i().createElement(K.default,null)),i().createElement(ee.Options,{openOptions:a,setOpenOptions:s,trigger:I,setTrigger:Z,projects:y,setProjects:w,store:j,drawerWidth:"25%"})," ",i().createElement(e,{sharedProps:P,module:t,inactive:!1}))}}(W,e);return i().createElement("div",{style:{width:e.dimensions.w,height:e.dimensions.h}},i().createElement(z.RecoilRoot,null,i().createElement(Y.QueryClientProvider,{client:new Y.QueryClient},i().createElement(t,{module:e}))))})));const ie=ne},60306:e=>{"use strict";e.exports=JSON.parse('{"name":"viewer","version":"1.0.0","port":8082,"domain":"https://consolidproject.github.io/pluginViewer/","scripts":{"start":"webpack serve --config config/webpack.dev.js","build:dev":"webpack --config config/webpack.dev.js","build":"webpack --config config/webpack.prod.js"},"dependencies":{"@comunica/actor-init-sparql":"^1.22.2","@inrupt/solid-client-authn-browser":"^1.11.2","@material-ui/core":"^4.12.3","@material-ui/icons":"^4.9.1","@xeokit/xeokit-sdk":"^1.9.0","assert":"^2.0.0","browserify-zlib":"^0.2.0","buffer":"^6.0.3","consolid":"^1.0.7","consolid-react-ui":"0.0.11","core-js":"^3.18.1","crypto-browserify":"^3.12.0","events":"^3.3.0","graphql-ld-comunica-solid":"^1.0.1","lodash.difference":"^4.5.0","mem":"^9.0.1","n3":"^1.10.0","os-browserify":"^0.3.0","path-browserify":"^1.0.1","process":"^0.11.10","prop-types":"^15.7.2","react":"^17.0.1","react-dom":"^17.0.1","react-query":"^3.24.4","react-router-dom":"^5.2.0","recoil":"^0.4.1","source-map-loader":"^3.0.0","stream-browserify":"^3.0.0"},"devDependencies":{"@babel/core":"^7.12.3","@babel/plugin-transform-runtime":"^7.12.1","@babel/preset-env":"^7.12.1","@babel/preset-react":"^7.12.1","babel-loader":"^8.1.0","clean-webpack-plugin":"^3.0.0","css-loader":"^5.0.0","html-webpack-plugin":"^4.5.0","style-loader":"^2.0.0","webpack":"^5.4.0","webpack-cli":"^4.7.0","webpack-dev-server":"^3.11.0","webpack-merge":"^5.2.0"}}')}}]);